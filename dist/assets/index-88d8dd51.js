import{_,b as h,e as r,f as c,g as t,y as i,q as b,u,F as y,m as p,j as a,l as x,A as k}from"./index-7fd2beec.js";const w={data(){return{list_dsBooking:[],delete_booking:{},loading:!0,search:{from_date:"",to_date:""}}},methods:{formatVND(o){return new Intl.NumberFormat("vi-VI",{style:"currency",currency:"VND"}).format(o)},formatDate(o){if(!o)return"---";const s=new Date(o);return`${s.getDate().toString().padStart(2,"0")}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getFullYear()}`},getStatusStyle(o){switch(o){case"da_thanh_toan":return"background-color: #28a745; color: white;";case"cho_xu_ly":return"background-color: #ffc107; color: #333;";case"da_huy":return"background-color: #dc3545; color: white;";default:return"background-color: #f8f9fa; color: #333;"}},changeStatus(o,s){const m=this.list_dsBooking.findIndex(l=>l.id===o);m!==-1&&(this.list_dsBooking[m].trang_thai=s,h.post("/admin/dat-tour/change-status",{id:o,trang_thai:s}).then(l=>{l.data.status?this.$toast.success(l.data.message):(this.$toast.error(l.data.message||"Cập nhật trạng thái thất bại."),this.getDanhSach())}).catch(l=>{this.$toast.error("Lỗi hệ thống khi cập nhật trạng thái."),console.error("Lỗi cập nhật trạng thái:",l),this.getDanhSach()}))},getDanhSach(){this.loading=!0,h.get("/admin/chi-tiet-dat-tour/get-data").then(o=>{this.list_dsBooking=o.data.data}).catch(o=>{console.error("Lỗi tải danh sách booking:",o),this.list_dsBooking=[]}).finally(()=>{this.loading=!1})},xoaDanhSach(){h.post("/admin/dat-tour/delete",this.delete_booking).then(o=>{this.getDanhSach(),this.$toast.success(o.data.message)})},locDanhSach(){this.loading=!0,h.post("/admin/dat-tour/loc-thong-tin",{from_date:this.search.from_date||null,to_date:this.search.to_date||null}).then(o=>{this.list_dsBooking=o.data.data}).catch(o=>{console.error("Lỗi lọc danh sách booking:",o),this.list_dsBooking=[]}).finally(()=>{this.loading=!1})},taiLai(){this.search.from_date="",this.search.to_date="",this.getDanhSach()}},mounted(){this.getDanhSach()}},v={class:"container py-4"},S={class:"card border-0 shadow-lg",style:{"background-color":"white","border-radius":"12px"}},D={class:"card-body p-4"},B={class:"row g-3 mb-4 align-items-end",style:{"border-bottom":"1px solid #e9ecef","padding-bottom":"20px"}},C={class:"col-12 col-lg-7"},L={class:"row g-2 justify-content-lg-end align-items-end"},z={class:"col-6 col-md-4 col-lg-3"},V={class:"col-6 col-md-4 col-lg-3"},F={class:"col-6 col-md-2 col-lg-auto"},N={class:"col-6 col-md-1 col-lg-auto"},T={class:"table-responsive"},M={class:"table table-hover align-middle mb-0",style:{"min-width":"1200px"}},H={key:0},I={key:1},j={class:"ps-3 fw-bold text-primary"},A={class:"d-flex align-items-center"},K=["src"],X={class:"d-flex flex-column lh-sm"},O={class:"fw-bold text-dark",style:{"font-size":"0.95rem"}},U={class:"text-muted",style:{"font-size":"0.8rem"}},q={class:"fw-bold text-dark"},E={key:0,class:"mt-1"},G={class:"badge text-danger border border-danger border-opacity-25",style:{background:"#fde8e8"}},Q={class:"d-inline-flex align-items-center bg-white border rounded-pill px-3 py-1 shadow-sm"},Y={class:"d-flex align-items-center"},J={class:"fw-bold text-dark small me-1"},P={class:"d-flex align-items-center"},R={class:"text-muted small me-1"},W={class:"text-center"},Z={class:"fw-bold text-dark"},$={class:"text-end"},tt={class:"fw-bolder fs-6",style:{color:"#dc3545"}},st={class:"text-center"},et=["value","onChange"],ot={class:"text-center"},at=["onClick"],nt={class:"modal fade",id:"xoaModal",tabindex:"-1","aria-labelledby":"xoaModalLabel","aria-hidden":"true"},lt={class:"modal-dialog modal-dialog-centered"},dt={class:"modal-content border-0 shadow",style:{"border-radius":"12px"}},it={class:"modal-body text-center p-4"},rt={class:"text-secondary"},ct={class:"fw-bold"},ht={class:"modal-footer justify-content-center border-0 pb-4"};function mt(o,s,m,l,n,d){return r(),c(y,null,[t("div",v,[t("div",S,[t("div",D,[t("div",B,[s[9]||(s[9]=t("div",{class:"col-12 col-lg-5"},[t("h4",{class:"fw-bolder mb-1",style:{color:"#007bff"}},[t("i",{class:"fa-solid fa-clipboard-list me-2"}),i(" DANH SÁCH BOOKING ")]),t("span",{class:"text-secondary small"},"Quản lý và theo dõi các đơn hàng du lịch của khách.")],-1)),t("div",C,[t("div",L,[t("div",z,[s[5]||(s[5]=t("label",{class:"text-secondary fw-bold mb-1",style:{"font-size":"0.85rem"}},"Từ ngày",-1)),b(t("input",{type:"date",class:"form-control form-control-sm border-secondary","onUpdate:modelValue":s[0]||(s[0]=e=>n.search.from_date=e),style:{"border-radius":"8px"}},null,512),[[u,n.search.from_date]])]),t("div",V,[s[6]||(s[6]=t("label",{class:"text-secondary fw-bold mb-1",style:{"font-size":"0.85rem"}},"Đến ngày",-1)),b(t("input",{type:"date",class:"form-control form-control-sm border-secondary","onUpdate:modelValue":s[1]||(s[1]=e=>n.search.to_date=e),style:{"border-radius":"8px"}},null,512),[[u,n.search.to_date]])]),t("div",F,[t("button",{class:"btn btn-primary btn-sm w-100 text-white shadow-sm",onClick:s[2]||(s[2]=e=>d.locDanhSach()),style:{"border-radius":"8px","font-weight":"bold"}},[...s[7]||(s[7]=[t("i",{class:"fa-solid fa-filter me-1"},null,-1),i(" Lọc ",-1)])])]),t("div",N,[t("button",{class:"btn btn-outline-secondary btn-sm w-100 border",title:"Tải lại",onClick:s[3]||(s[3]=e=>d.taiLai()),style:{"border-radius":"8px"}},[...s[8]||(s[8]=[t("i",{class:"fa-solid fa-rotate-right"},null,-1)])])])])])]),t("div",T,[t("table",M,[s[19]||(s[19]=t("thead",{style:{"background-color":"#f8f9fa"}},[t("tr",{style:{"font-size":"0.8rem","text-transform":"uppercase"}},[t("th",{class:"text-secondary py-3 ps-3",style:{width:"100px"}},"Mã đơn hàng"),t("th",{class:"text-secondary py-3",style:{width:"220px"}},"Khách hàng & Liên hệ"),t("th",{class:"text-secondary py-3",style:{width:"250px"}},"Tour đã đặt"),t("th",{class:"text-secondary py-3",style:{width:"150px"}},"Chi tiết đặt"),t("th",{class:"text-secondary py-3 text-center",style:{width:"100px"}},"Ngày đặt"),t("th",{class:"text-secondary py-3 text-end",style:{width:"150px"}},"Tổng tiền thực nhận"),t("th",{class:"text-secondary py-3 text-center",style:{width:"120px"}},"Trạng thái"),t("th",{class:"text-secondary py-3 text-center",style:{width:"110px"}},"Hành động")])],-1)),t("tbody",null,[n.loading?(r(),c("tr",H,[...s[10]||(s[10]=[t("td",{colspan:"8",class:"text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")]),t("p",{class:"mt-2 text-primary fw-bold"},"Đang tải dữ liệu...")],-1)])])):n.list_dsBooking.length===0?(r(),c("tr",I,[...s[11]||(s[11]=[t("td",{colspan:"8",class:"text-center text-muted py-4"},[t("i",{class:"fa-solid fa-info-circle me-2"}),i(" Không tìm thấy đơn đặt tour nào trong phạm vi đã chọn. ")],-1)])])):(r(!0),c(y,{key:2},p(n.list_dsBooking,(e,f)=>(r(),c("tr",{key:f,style:{"font-size":"0.9rem"}},[t("td",j," #"+a(e.ma_don_hang),1),t("td",null,[t("div",A,[t("img",{src:e.avatar||"https://placehold.co/40x40/adb5bd/FFFFFF?text=AV",class:"border shadow-sm me-3",style:{width:"40px",height:"40px","border-radius":"50%","object-fit":"cover"}},null,8,K),t("div",X,[t("span",O,a(e.ten_khach_hang||e.ten_lien_lac),1),t("small",U,[s[12]||(s[12]=t("i",{class:"fa-solid fa-phone me-1"},null,-1)),i(" "+a(e.so_dien_thoai_lien_lac),1)])])])]),t("td",null,[t("span",q,a(e.ten_tour),1),e.phan_tram_giam>0?(r(),c("div",E,[t("span",G,[s[13]||(s[13]=t("i",{class:"fa-solid fa-ticket me-1"},null,-1)),i(" Voucher: -"+a(e.phan_tram_giam)+"% ",1)])])):x("",!0)]),t("td",null,[t("div",Q,[t("div",Y,[t("span",J,a(e.so_nguoi_lon),1),s[14]||(s[14]=t("i",{class:"fas fa-user text-primary",style:{"font-size":"0.75rem"}},null,-1))]),s[16]||(s[16]=t("div",{class:"border-start mx-2",style:{height:"14px"}},null,-1)),t("div",P,[t("span",R,a(e.so_tre_em),1),s[15]||(s[15]=t("i",{class:"fas fa-child text-secondary",style:{"font-size":"0.75rem"}},null,-1))])])]),t("td",W,[t("span",Z,a(d.formatDate(e.ngay_dat)),1)]),t("td",$,[t("span",tt,a(d.formatVND(e.tien_thuc_nhan)),1)]),t("td",st,[t("select",{class:"form-select form-select-sm fw-bold text-white mx-auto",value:e.trang_thai,onChange:g=>d.changeStatus(e.id,g.target.value),style:k([d.getStatusStyle(e.trang_thai),{border:"none","border-radius":"8px","min-width":"110px"}])},[...s[17]||(s[17]=[t("option",{value:"cho_xu_ly",style:{"background-color":"#ffc107",color:"#333"}},"Chờ xử lý",-1),t("option",{value:"da_thanh_toan",style:{"background-color":"#28a745",color:"white"}},"Hoàn tất",-1),t("option",{value:"da_huy",style:{"background-color":"#dc3545",color:"white"}},"Đã hủy",-1)])],44,et)]),t("td",ot,[t("button",{class:"btn btn-sm btn-link p-1 text-danger border-0 bg-transparent",onClick:g=>n.delete_booking=e,"data-bs-toggle":"modal","data-bs-target":"#xoaModal",title:"Xóa đơn hàng"},[...s[18]||(s[18]=[t("i",{class:"fa-solid fa-trash-can",style:{"font-size":"16px"}},null,-1)])],8,at)])]))),128))])])])])])]),t("div",nt,[t("div",lt,[t("div",dt,[s[25]||(s[25]=t("div",{class:"modal-header bg-danger text-white border-0",style:{"border-radius":"12px 12px 0 0"}},[t("h5",{class:"modal-title",id:"xoaModalLabel"},[t("i",{class:"fa-solid fa-triangle-exclamation me-2"}),i(" Xác nhận xoá đơn hàng ")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Đóng"})],-1)),t("div",it,[s[21]||(s[21]=t("div",{style:{"font-size":"48px",color:"#dc3545"}},[t("i",{class:"fa-solid fa-trash-can"})],-1)),s[22]||(s[22]=t("h5",{class:"mt-3"},"Bạn có chắc chắn muốn xóa?",-1)),t("p",rt,[s[20]||(s[20]=i("Tên Tour: ",-1)),t("span",ct,a(n.delete_booking.ten_tour),1)]),s[23]||(s[23]=t("span",{class:"small text-danger fw-bold"},"Hành động này không thể hoàn tác và có thể ảnh hưởng đến dữ liệu thống kê.",-1))]),t("div",ht,[s[24]||(s[24]=t("button",{type:"button",class:"btn btn-secondary px-4","data-bs-dismiss":"modal",style:{"border-radius":"50rem"}},"Hủy",-1)),t("button",{type:"button",class:"btn btn-danger px-4",onClick:s[4]||(s[4]=e=>d.xoaDanhSach()),"data-bs-dismiss":"modal",style:{"border-radius":"50rem"}},"Xoá")])])])])],64)}const bt=_(w,[["render",mt]]);export{bt as default};
